import 'dart:math';

// åŠ ç­æ—¶é•¿é˜ˆå€¼ï¼ˆåˆ†é’Ÿï¼‰åŠå¯¹åº”çš„æ–‡æ¡ˆåˆ—è¡¨
final Map<int, List<String>> _overtimeMessages = {
  1: [
    "â˜ ï¸å»ºè®®å°†ã€è·¨å‡ºå…¬å¸é—¨æ—¶è¢«å–Šå›æ¥ã€åˆ—å…¥æ–°å‹å·¥ä¼¤é‰´å®šæ ‡å‡†",
  ],
  5: [
    "â°åŠ ç­èƒ½é‡è­¦å‘Šï¼šæ‚¨åˆšåˆšç‡ƒçƒ§äº†å¯å…‘æ¢åŠé¢—èŒ¶å¶è›‹çš„é’æ˜¥",
    "ğŸ”’è§£é”å®‡å®™çº§PUAï¼šã€ä½ åœ¨ä¸ºè‡ªå·±å¥‹æ–—ã€â‰ˆã€æˆ‘çš„æ¸¸è‰‡ç¼ºä¸ªé”šã€",
  ],
  10: [
    "ğŸŒè§£é”å¹³è¡Œå®‡å®™ï¼šæ­¤åˆ»æ­£å¸¸ä¸‹ç­çš„ä½ æ­£åœ¨å¤å¨å¤·åƒè èæŠ«è¨ï¼ˆç³»ç»Ÿå´©æºƒç‰ˆï¼‰",
    "ğŸ±ã€Šæ¶ˆå¤±çš„ä»ªå¼æ„Ÿã€‹- ç—›å¤±ç»™çŒ«ä¸»å­å¼€ç½å¤´çš„äº²å­äº’åŠ¨æ—¶å…‰",
    "ğŸŒŒé­”å¹»ç°å®ä¸»ä¹‰ï¼šæœ‹å‹åœˆåˆ·åˆ°å‰åŒäº‹åœ¨å†°å²›çœ‹æå…‰ï¼Œè€Œä½ åœ¨çœ‹ä»£ç æå…‰",
  ],
  20: [
    "ğŸ’¼ç³»ç»Ÿå…¬å‘Šï¼šæ‚¨å·²è‡ªåŠ¨ç»­è´¹ã€è€æ¿ã®è´¢åŠ¡è‡ªç”±æ¢¦æƒ³ã€ç»ˆæä¼—ç­¹è®¡åˆ’",
    "ğŸ’è§£é”æˆå°±ï¼šç”¨åŠ ç­æ—¶é•¿å…‘æ¢è€æ¿æ–°è¡¨âŒšç§’é’ˆè·³åŠ¨0.3åœˆ",
    "ğŸ’†â€â™‚ï¸æ¸©é¦¨æç¤ºï¼šæ‚¨çš„å¿ƒè„æ­£åœ¨ç”³è¯·ã€ä¸ä¸ºè€æ¿æ¢¦æƒ³è·³åŠ¨ã€åŸºæœ¬äººæƒ",
  ],
  30: [
    "ğŸ’†â€â™‚ï¸ç³»ç»Ÿæç¤ºï¼šæ‚¨çš„æ¤å‘æˆæ´»ç‡æ­£ä»¥200%é€Ÿåº¦å‘åœ°ä¸­æµ·é€€åŒ–",
    "ğŸ“ºå½“åŠ ç­æ—¶é•¿=è¿½å®Œä¸€é›†ã€Šç”„å¬›ä¼ ã€‹ï¼Œä½ å°±æ˜¯é’®ç¥œç¦„Â·æ”¹ä¸å®Œæ–¹æ¡ˆÂ·æ°",
    "ğŸ’†â€â™‚ï¸å²è¯—æˆå°±ï¼šè®©èŸ‘è‚äº§ç”Ÿã€è¿™è´§æ¯”æˆ‘èƒ½ç†¬ã€çš„ç§æ—ç„¦è™‘",
  ],
  60: [
    "ğŸ®ä¸€å°æ—¶=ç—›å¤±åœ¨steamå¤ä¿ƒæ¸¸æˆé‡Œä½“éªŒå½“ç”²æ–¹çš„çè´µäººç”Ÿ",
    "âš ï¸ç³»ç»Ÿè­¦å‘Šï¼šæ‚¨å·²é”™è¿‡é»„é‡‘æ¤å‘é¢„çº¦æ—¶æ®µå¹¶è§£é”åœ°ä¸­æµ·çš®è‚¤ä½“éªŒ",
    "ğŸ’†â€â™‚ï¸æ­å–œï¼æ‚¨ä¸ºè€æ¿å°ä¸‰çš„é“‚é‡‘åŒ…è´¡çŒ®äº†0.00001%ç©ºæ°”ä½¿ç”¨æƒ",
    "â›µï¸ã€Šæ—¶é—´é€šè´§è†¨èƒ€ã€‹- ä½ ç‡ƒçƒ§1å°æ—¶â‰ˆè€æ¿æ¸¸è‰‡å¤š1å˜ç±³æ²¹æ¼†",
  ],
  90: [
    "âš ï¸ç³»ç»Ÿæç¤ºï¼šæ‚¨çš„è‚å·²è‡ªåŠ¨ç»­è´¹ã€ç¦æŠ¥äººç”Ÿå°Šäº«å¥—é¤ã€",
  ],
  120: [
    "ğŸ’†â€â™‚ï¸ä¸¤å°æ—¶å®šå¾‹ï¼šè¶³å¤Ÿè®©è€æ¿ä»ã€ä½ å¾ˆåŠªåŠ›ã€è¿›åŒ–åˆ°ã€æˆ‘è§‰å¾—ä½ å¯ä»¥å†çªç ´ã€",
  ],
  180: [
    "ğŸ“–è§£é”ã€Šå±±æµ·ç»ã€‹æ–°ç‰©ç§ï¼šæ‹¥æœ‰é»‘çœ¼åœˆã®å½“ä»£åˆ‘å¤©ï¼ˆä»¥è‚ä»£é¦–ç‰ˆï¼‰",
  ],
  240: [
    "ğŸ¬å½“åŠ ç­æ—¶é•¿=çœ‹å®Œã€ŠæŒ‡ç¯ç‹ã€‹ä¸‰éƒ¨æ›²ï¼Œä½ å°±æ˜¯ä¸­åœŸä¸–ç•Œã®PPTæŠ¤æˆ’ä½¿è€…",
  ],
  300: [
    "ğŸ’†â€â™‚ï¸äº”å°æ—¶æ¸¡åŠ«æŒ‡å—ï¼šä»æ‰“å·¥äººåˆ°ä¿®ä»™è€…çš„åŸºå› çªå˜å·²å®Œæˆ87.53%",
  ],
};

// è·Ÿè¸ªä¸Šæ¬¡æ›´æ–°æ—¶é—´å’Œä¿¡æ¯
DateTime? _lastMessageUpdateTime;
String? _currentOvertimeMessage;
int? _lastOvertimeThreshold;

/// æ ¹æ®åŠ ç­æ—¶é•¿è·å–éšæœºæ–‡æ¡ˆ
String getRandomOvertimeMessage(Duration overtimeDuration) {
  // å°†åŠ ç­æ—¶é•¿è½¬æ¢ä¸ºåˆ†é’Ÿ
  final overtimeMinutes = overtimeDuration.inMinutes;
  
  // ç¡®å®šå½“å‰åŠ ç­æ—¶é•¿å¯¹åº”çš„é˜ˆå€¼
  int currentThreshold = 1; // é»˜è®¤æœ€ä½é˜ˆå€¼
  
  // æŸ¥æ‰¾é€‚ç”¨çš„æœ€å¤§é˜ˆå€¼
  for (final threshold in _overtimeMessages.keys) {
    if (overtimeMinutes >= threshold) {
      currentThreshold = threshold;
    } else {
      break;
    }
  }
  
  // æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°æ¶ˆæ¯
  final now = DateTime.now();
  
  // å¦‚æœå°šæœªè®¾ç½®æ¶ˆæ¯ï¼Œæˆ–è€…å·²ç»è¿‡äº†5åˆ†é’Ÿï¼Œæˆ–è€…é˜ˆå€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™æ›´æ–°æ¶ˆæ¯
  if (_currentOvertimeMessage == null || 
      _lastMessageUpdateTime == null || 
      now.difference(_lastMessageUpdateTime!).inMinutes >= 5 ||
      _lastOvertimeThreshold != currentThreshold) {
    
    // è·å–å½“å‰é˜ˆå€¼å¯¹åº”çš„æ–‡æ¡ˆåˆ—è¡¨
    final messages = _overtimeMessages[currentThreshold]!;
    
    // éšæœºé€‰æ‹©ä¸€æ¡æ–‡æ¡ˆ
    final random = Random();
    _currentOvertimeMessage = messages[random.nextInt(messages.length)];
    
    // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´å’Œé˜ˆå€¼
    _lastMessageUpdateTime = now;
    _lastOvertimeThreshold = currentThreshold;
  }
  
  return _currentOvertimeMessage!;
} 