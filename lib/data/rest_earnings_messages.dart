/// 摸鱼收入档位及对应文案列表
final Map<int, List<String>> restEarningsMessages = {
  0: [
    "恭喜解锁摸鱼界青铜选手！这点钱刚好买包辣条补充战斗力🌶️",
    "系统检测到您已赚回今日工位电费！请继续保持光合作用状态🔋",
    "🔔叮~ 您的煎饼基金已覆盖葱花自由，下一步解锁火腿肠VIP特权！",
    "摸鱼收益≈老板每分钟呼吸损耗，但你的每一秒都在增值💰",
    "再摸5分钟，瑞幸冰咖马上到账✨",
    "老板的心痛多跳一次，您的蜜雪冰城圣代就多加颗草莓🍓"
  ],
  10: [
    "10元到账！相当于用老板的A4纸折了艘黄金船🚢",
    "温馨提示：当前余额可兑换奶茶店🧋股东体验卡（限时30秒）",
    "恭喜击败全国88%的带薪发呆用户！加把劲解锁薯条加购权🍟",
    "温馨提示：现在放弃=自愿成为老板新车的螺丝钉🔩"
  ],
  18: [
    "摸鱼能量充能98%！差2元即可发射『咖啡因拯救世界』计划☕",
    "从资本家指甲缝里抠出个星巴克中杯！",
    "当代职场礼仪：用摸鱼钱买咖啡，续命继续帮老板圆谎☕️",
    "解锁摸鱼学新成就：用公司电费赚够奶茶钱（功德+1🙏）"
  ],
  30: [
    "同事在卷周报，我在摸鱼，最后他得腱鞘炎我赚按摩费，赢！",
    "🐟摸鱼暴富公式：30元×22个工作日=老板痛失爱马仕皮带一条",
    "您已获得电影票半价资格，请选择：继续摸鱼 🆚 赞助老板度假？",
    "摸到瑞幸自由！✌️",
    "打工暂停！先提30块请自己喝秋天的第一杯奶茶"
  ],
  50: [
    "摸出电影自由！本档奖励可选IMAX影票×2🎬",
    "恭喜突破精英关卡！50元够吃日料定食啦🍣",
    "老板在开会？再摸50分钟=白得泡泡玛特盲盒🎁",
    "摸鱼金币+50！建议购买：奶茶+蛋糕治愈套餐🍰",
    "摸到50巨款！够请PM喝奶茶🧋了——如果他愿意把需求吞回去的话"
  ],
  100: [
    "检测到摸鱼收益＞公司团建人均经费！",
    "🐟摸鱼经济学第一课：当你的时薪超过楼下便利店，就赢了！",
    "系统警告：您已掌握『用老板画的饼就着摸鱼钱下饭』生存技能🫓"
  ],
  200: [
    "恭喜摸出马尔代夫空气！当前余额可兑换0.5㎡海岛使用权🌴",
    "🔔叮~200元到账！建议用途：剧本杀车队集资",
    "摸鱼王者进度20%！当前够买3支YSL小金条💄",
    "系统提示：本档奖励可兑换迪士尼门票1/3张🎫",
    "累计时长分析：您已摸出价值AirPods Pro的零花钱🎧",
    "200元=奶茶×10杯=电影×4场=火锅×1顿…但持续摸鱼=ALL IN💪"
  ],
  300: [
    "再摸半小时，Switch卡带任选三款不是梦！🎮",
    "这个数够买整套神仙水，摸到就是赚到美貌！💄",
    "主子罐头自由近在眼前，喵星人催你继续划水！🐱",
    "700元≈带薪💩300次的奖金（嘘！别让行政发现厕所VIP是您）",
    "摸鱼能量+300！检测到可兑换《老板画的饼突然不噎了》体验卡🍕"
  ],
  500: [
    "当前金额可入手Switch游戏卡×3🎮",
    "摸鱼经济学：您的时间≈SK-II神仙水30ml💄",
    "特别通知：本档金额支持分期购买无人机首付🛸",
    "摸鱼相对论：赚得越多，证明你浪费在会议上的生命越多🤔"
  ],
  1000: [
    "摸满四位数，马尔代夫机票钱就攒够零头啦！✈️",
    "摸鱼界传说：当金额破千时，老板的眼泪会变成珍珠奶茶里的珍珠💧",
    "坚持住！王者全皮肤的钱快攒够了！🎁",
    "叮~检测到可兑换PS5数字版，请持续摸鱼充能🎮",
    "千元成就达成！已为您预约Tony老师总监烫染套餐💆‍♂️"
  ],
  2000: [
    "2000元=48小时迪士尼尊享导览，童话世界等你打卡🏰",
    "再摸两轮，switch全家桶+健身环套装直接抱走🎮",
    "检测到可兑换任天堂股票1股，成为世界主宰股东💼",
    "恭喜集齐美容仪首付！逆龄生长程序已启动💆‍♂️"
  ],
  5000: [
    "摸鱼宗师认证！当前可全款拿下iPhone15Pro💻",
    "系统播报：您已摸出马尔代夫双人机票+1晚住宿🏝️",
    "隐藏成就达成：摸鱼收益超过90后平均存款💰",
    "财富密码破译！当前金额=普通人半年咖啡预算🥤",
    "恭喜完成终极挑战！下一目标：摸出特斯拉首付🚗",
    "终极哲学：摸到这么多还没离职，说明你已经学会与虚无共舞🤔"
  ],
};

// 添加上次更新时间和当前显示文案的记录
DateTime _lastMessageUpdateTime = DateTime(1970); // 初始化为很久以前的时间，确保第一次调用时会更新
String _currentMessage = "老板的心痛多跳一次，您的蜜雪冰城圣代就多加颗草莓🍓";
int? _lastThreshold; // 记录上次的收入档位

/// 获取摸鱼收入对应的随机文案
/// 每隔5分钟更新一次，或者当收入档位变化时更新
String getRandomRestEarningMessage(double restEarning) {
  final now = DateTime.now();
  
  // 查找当前摸鱼收入对应的档位
  int? currentThreshold;
  for (final threshold in restEarningsMessages.keys.toList()..sort()) {
    if (restEarning >= threshold) {
      currentThreshold = threshold;
    } else {
      break;
    }
  }
  
  // 计算距离上次更新的时间（分钟）
  final minutesSinceLastUpdate = now.difference(_lastMessageUpdateTime).inMinutes;
  
  // 判断是否需要更新文案：
  // 1. 已经过了5分钟
  // 2. 收入档位发生变化
  // 3. 还没有设置过文案（第一次调用）
  if (minutesSinceLastUpdate >= 5 || currentThreshold != _lastThreshold || _currentMessage == "老板的心痛多跳一次，您的蜜雪冰城圣代就多加颗草莓🍓") {
    // 如果没有匹配到任何档位，返回默认文案
    if (currentThreshold == null) {
      _currentMessage = "老板的心痛多跳一次，您的蜜雪冰城圣代就多加颗草莓🍓";
    } else {
      // 从对应档位的文案列表中随机选择一条
      final messageList = restEarningsMessages[currentThreshold]!;
      final randomIndex = DateTime.now().millisecondsSinceEpoch % messageList.length;
      _currentMessage = messageList[randomIndex];
    }
    
    // 更新上次更新时间和档位记录
    _lastMessageUpdateTime = now;
    _lastThreshold = currentThreshold;
  }
  
  // 返回当前文案（可能是刚刚更新的，也可能是之前的）
  return _currentMessage;
} 